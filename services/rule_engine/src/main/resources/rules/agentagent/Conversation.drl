package rules.agentagent;

import com.mindsmiths.dbAdapter.DBAdapterAPI;
import com.mindsmiths.dbAdapter.FetchResult;
import com.mindsmiths.ruleEngine.util.Log;
import com.mindsmiths.telegramAdapter.TelegramReceivedMessage;
import com.mindsmiths.ruleEngine.model.Initialize;
import com.mindsmiths.telegramAdapter.TelegramKeyboardAnswered;

import agents.AgentAgent;
import signals.UserIdSignal;


rule "Set AgentAgent user id"
    when
        sig: UserIdSignal() from entry-point "signals"
        agent: AgentAgent()
    then
        Log.warn("Received signal");
        Log.info(sig.getUserId());
        DBAdapterAPI.fetchUser(sig.getUserId());
end

rule "Send AgentAgent contact info"
    when
        res: FetchResult(success == true) from entry-point "signals"
        agent: AgentAgent()
    then
        agent.sendContactInfo(res.getUsers().get(0));
        agent.sendSurvey();
        delete(res);
end

rule "Update user bought"
    when
        res: FetchResult(success == true) from entry-point "signals"
        answer: TelegramKeyboardAnswered()
        agent: AgentAgent()
    then
        agent.handleFetchResult(res.getUsers().get(0), answer.getAnswer());
        delete(answer);