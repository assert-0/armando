global:
  dependencies:
    python:
      - forge-sdk==4.0.0a9
      - forge-cli==4.0.0a8
      - cecs==4.0.0a1
      - services/*.py
  env:
    PROJECT_SLUG: "armando"

    ENVIRONMENT_NAME: {{ env.CI_COMMIT_REF_SLUG }}
    MODULE: '{{ env.MODULE | default("local", True) }}'
    LOG_LEVEL: INFO

    # Messaging
    PULSAR_URL: pulsar://pulsar-proxy.pulsar.svc.cluster.local:6650

    # Databases
    MONGO_CLIENT_HOST: mongodb:27017
    MONGO_CLIENT_USERNAME: root

    POSTGRES_CLIENT_HOST: postgresql
    POSTGRES_CLIENT_PORT: '5432'
    POSTGRES_CLIENT_USERNAME: postgres

    REDIS_URL: redis-master:6379

    # Misc
    DEFAULT_TIME_ZONE: Europe/Zagreb

  secrets:
    SENTRY_DSN: '{{ env.SENTRY_DSN }}'

    MONGO_CLIENT_PASSWORD: admin
    POSTGRES_CLIENT_PASSWORD: admin

  cecs:
    params: -e venv

  repository: nexus.vingd.net

services:
  rule-engine:
    type: java
    resources:
      cpu: 500m
      memory: 650Mi

  heartbeat-scheduler:
    package: heartbeat
    type: python
    version: 4.0.0a4
    env:
      HEARTBEAT_CYCLE: 5
    db:
      mongo: true
    dependencies:
      - rule-engine-api==4.0.0a20
    resources:
      cpu: 69m
      memory: 65Mi

  heartbeat-sender:
    package: heartbeat
    type: python
    version: 4.0.0a4
    db:
      mongo: true
    dependencies:
      - rule-engine-api==4.0.0a20
    resources:
      cpu: 84m
      memory: 94Mi

  telegram-adapter:
    type: python
    version: 4.0.0a11
    db:
      mongo: true
    env:
      TELEGRAM_BOT_TOKEN: "{{env.TELEGRAM_BOT_TOKEN}}"
    resources:
      cpu: 81m
      memory: 130Mi

  db-adapter:
    type: python
    db:
      mongo: true
    env:
      DB_FILE: 'services/db_adapter/data.csv'
    resources:
      cpu: 100m
      memory: 100Mi

  mitems:
    type: django
    db:
      postgres: true
    env:
      SITE_URL: '{{ "mitems." + env.get("HOST_DOMAIN", "") }}'
      INTERNAL_SITE_URL: "http://mitems/"
      DJANGO_SUPERUSER_USERNAME: admin
      DJANGO_SUPERUSER_PASSWORD: '{{ env.MITEMS_ADMIN_PASSWORD | default("knopso123") }}'
      COMMIT_TOKEN: '{{ env.COMMIT_TOKEN }}'
      REPO: '{{ env.CI_REPOSITORY_URL }}'
      BRANCH: '{{ env.CI_COMMIT_BRANCH }}'
      SECRET_KEY: KE00K%SJ8vjYX46!%6$W3Js1OewOAmk@
    dependencies:
      - django==3.2.13
      - django-environ==0.8.1
      - psycopg2-binary==2.9.3
      - gunicorn==20.1.0
      - django-jet-reboot==1.3.1
      - django-tinymce==3.4.0
      - django-json-widget==1.1.1
      - django-debug-toolbar==3.2.4
      - beautifulsoup4==4.11.1
      - python-slugify==6.1.2
    resources:
      cpu: 100m
      memory: 110Mi
